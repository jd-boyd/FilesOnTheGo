<!-- Enhanced Share Modal Component -->
<!-- Comprehensive share creation and management dialog -->

<div id="share-modal"
     class="fixed z-50 inset-0 overflow-y-auto hidden"
     aria-labelledby="share-modal-title"
     role="dialog"
     aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
             onclick="closeShareModal()"
             aria-hidden="true"></div>

        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

        <!-- Modal panel -->
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
            <!-- Header -->
            <div class="bg-white px-6 pt-6 pb-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100">
                            <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-lg leading-6 font-semibold text-gray-900" id="share-modal-title">
                                Share "<span id="share-item-name" class="text-primary">item</span>"
                            </h3>
                            <p class="text-sm text-gray-500" id="share-item-type-label">
                                <span id="share-resource-type-display">File</span>
                            </p>
                        </div>
                    </div>
                    <button type="button"
                            onclick="closeShareModal()"
                            class="text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary rounded-md p-1">
                        <span class="sr-only">Close</span>
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="bg-white px-6 py-6 max-h-[70vh] overflow-y-auto">
                <!-- Tabs -->
                <div class="border-b border-gray-200 mb-6">
                    <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                        <button type="button"
                                id="share-tab-create"
                                onclick="switchShareTab('create')"
                                class="share-tab border-primary text-primary whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm"
                                aria-current="page">
                            Create Share
                        </button>
                        <button type="button"
                                id="share-tab-existing"
                                onclick="switchShareTab('existing')"
                                class="share-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">
                            Existing Shares
                            <span id="existing-shares-count" class="ml-1.5 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600 hidden">0</span>
                        </button>
                    </nav>
                </div>

                <!-- Create Share Tab -->
                <div id="share-content-create" class="share-tab-content">
                    <form id="create-share-form"
                          onsubmit="return submitShareForm(event)">
                        <input type="hidden" name="resource_type" id="share-resource-type" value="file">
                        <input type="hidden" name="resource_id" id="share-resource-id" value="">

                        <!-- Permission Type Selection -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-3">
                                Permission Level
                            </label>
                            <div class="space-y-3">
                                <!-- Read-only -->
                                <label class="flex items-start p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors permission-option"
                                       data-permission="read">
                                    <input type="radio"
                                           name="permission_type"
                                           value="read"
                                           checked
                                           class="mt-1 h-4 w-4 text-primary border-gray-300 focus:ring-primary"
                                           onchange="updatePermissionSelection()">
                                    <div class="ml-3">
                                        <div class="flex items-center">
                                            <span class="text-sm font-medium text-gray-900">Read-only</span>
                                            <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                                RECOMMENDED
                                            </span>
                                        </div>
                                        <p class="text-sm text-gray-500 mt-1">
                                            Recipients can view and download files but cannot upload or modify anything.
                                        </p>
                                    </div>
                                </label>

                                <!-- Read & Upload -->
                                <label class="flex items-start p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors permission-option"
                                       data-permission="read_upload">
                                    <input type="radio"
                                           name="permission_type"
                                           value="read_upload"
                                           class="mt-1 h-4 w-4 text-primary border-gray-300 focus:ring-primary"
                                           onchange="updatePermissionSelection()">
                                    <div class="ml-3">
                                        <div class="flex items-center">
                                            <span class="text-sm font-medium text-gray-900">Read & Upload</span>
                                            <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                                                COLLABORATIVE
                                            </span>
                                        </div>
                                        <p class="text-sm text-gray-500 mt-1">
                                            Recipients can view, download, and upload new files to the shared location.
                                        </p>
                                    </div>
                                </label>

                                <!-- Upload-only -->
                                <label class="flex items-start p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors permission-option"
                                       data-permission="upload_only">
                                    <input type="radio"
                                           name="permission_type"
                                           value="upload_only"
                                           class="mt-1 h-4 w-4 text-primary border-gray-300 focus:ring-primary"
                                           onchange="updatePermissionSelection()">
                                    <div class="ml-3">
                                        <div class="flex items-center">
                                            <span class="text-sm font-medium text-gray-900">Upload-only</span>
                                            <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
                                                DROP BOX
                                            </span>
                                        </div>
                                        <p class="text-sm text-gray-500 mt-1">
                                            Recipients can only upload files but cannot view or download existing content.
                                        </p>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Password Protection -->
                        <div class="mb-6">
                            <div class="flex items-center justify-between">
                                <label class="flex items-center cursor-pointer">
                                    <input type="checkbox"
                                           id="share-password-toggle"
                                           class="h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary"
                                           onchange="toggleSharePassword()">
                                    <span class="ml-2 text-sm font-medium text-gray-700">Password protect</span>
                                </label>
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" title="Add extra security">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                </svg>
                            </div>
                            <div id="share-password-container" class="mt-3 hidden">
                                <input type="password"
                                       name="password"
                                       id="share-password"
                                       placeholder="Enter password"
                                       class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm"
                                       autocomplete="new-password">
                                <p class="mt-1.5 text-xs text-gray-500">
                                    Recipients will need to enter this password to access the shared content.
                                </p>
                            </div>
                        </div>

                        <!-- Expiration Date -->
                        <div class="mb-6">
                            <div class="flex items-center justify-between">
                                <label class="flex items-center cursor-pointer">
                                    <input type="checkbox"
                                           id="share-expiration-toggle"
                                           class="h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary"
                                           onchange="toggleShareExpiration()">
                                    <span class="ml-2 text-sm font-medium text-gray-700">Set expiration date</span>
                                </label>
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" title="Link will expire automatically">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div id="share-expiration-container" class="mt-3 hidden">
                                <input type="datetime-local"
                                       name="expires_at"
                                       id="share-expiration"
                                       class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm">
                                <!-- Quick presets -->
                                <div class="flex flex-wrap gap-2 mt-3">
                                    <button type="button"
                                            onclick="setShareExpiration(1)"
                                            class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                        1 day
                                    </button>
                                    <button type="button"
                                            onclick="setShareExpiration(7)"
                                            class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                        7 days
                                    </button>
                                    <button type="button"
                                            onclick="setShareExpiration(30)"
                                            class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                        30 days
                                    </button>
                                    <button type="button"
                                            onclick="setShareExpiration(90)"
                                            class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                        90 days
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Generate Button -->
                        <button type="submit"
                                id="create-share-btn"
                                class="w-full inline-flex justify-center items-center px-4 py-3 border border-transparent shadow-sm text-base font-medium rounded-md text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors">
                            <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                            </svg>
                            Generate Share Link
                        </button>
                    </form>

                    <!-- Share Result (shown after creation) -->
                    <div id="share-result" class="mt-6 hidden"></div>
                </div>

                <!-- Existing Shares Tab -->
                <div id="share-content-existing" class="share-tab-content hidden">
                    <div id="existing-shares-list" class="space-y-4">
                        <!-- Loading state -->
                        <div id="existing-shares-loading" class="flex justify-center py-8">
                            <svg class="animate-spin h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </div>

                        <!-- Empty state -->
                        <div id="existing-shares-empty" class="text-center py-8 hidden">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                            </svg>
                            <p class="mt-2 text-sm text-gray-500">No existing shares for this item.</p>
                            <button type="button"
                                    onclick="switchShareTab('create')"
                                    class="mt-3 text-sm text-primary hover:text-blue-700">
                                Create a share link
                            </button>
                        </div>

                        <!-- Shares will be dynamically inserted here -->
                        <div id="existing-shares-container"></div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
                <div class="flex items-center justify-between">
                    <a href="/shares"
                       class="text-sm text-gray-500 hover:text-primary flex items-center">
                        <svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                        </svg>
                        Manage all shares
                    </a>
                    <button type="button"
                            onclick="closeShareModal()"
                            class="inline-flex justify-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
