<!-- File List Component -->
<!-- Displays files and directories in a grid or list view -->
<div id="file-list-container"
     class="file-list-container"
     data-current-directory="{{.CurrentDirectoryID}}"
     data-view-mode="{{if .ViewMode}}{{.ViewMode}}{{else}}list{{end}}">

    {{if .IsLoading}}
    <!-- Loading State -->
    <div class="flex justify-center items-center py-12" id="file-list-loading">
        <div class="flex flex-col items-center">
            <svg class="animate-spin h-8 w-8 text-primary mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span class="text-sm text-gray-500">Loading files...</span>
        </div>
    </div>
    {{else if not .Items}}
    <!-- Empty State -->
    <div id="empty-state" class="text-center py-12">
        <svg class="mx-auto h-24 w-24 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
        </svg>
        <h3 class="text-xl font-medium text-gray-700 mb-2">No files yet</h3>
        <p class="text-gray-500 mb-4">Upload your first file to get started</p>
        <button type="button"
                class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
                onclick="openUploadModal()">
            <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
            </svg>
            Upload Files
        </button>
    </div>
    {{else}}
    <!-- List View -->
    <div id="file-list"
         class="{{if eq .ViewMode "grid"}}hidden{{end}}"
         role="list"
         aria-label="File list">
        <!-- Table Header -->
        <div class="file-list-header hidden sm:grid grid-cols-12 gap-4 px-4 py-3 bg-gray-50 border-b border-gray-200 text-xs font-medium text-gray-500 uppercase tracking-wider">
            <div class="col-span-1 flex items-center">
                <input type="checkbox"
                       id="select-all"
                       class="h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary"
                       aria-label="Select all files"
                       onchange="toggleSelectAll(this.checked)">
            </div>
            <div class="col-span-5 flex items-center cursor-pointer hover:text-gray-700"
                 hx-get="/api/files?directory_id={{.CurrentDirectoryID}}&sort=name&order={{if eq .SortBy "name"}}{{if eq .SortOrder "asc"}}desc{{else}}asc{{end}}{{else}}asc{{end}}"
                 hx-target="#file-list-container"
                 hx-push-url="false">
                Name
                {{if eq .SortBy "name"}}
                <svg class="ml-1 h-4 w-4 {{if eq .SortOrder "desc"}}transform rotate-180{{end}}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                </svg>
                {{end}}
            </div>
            <div class="col-span-2 flex items-center cursor-pointer hover:text-gray-700"
                 hx-get="/api/files?directory_id={{.CurrentDirectoryID}}&sort=size&order={{if eq .SortBy "size"}}{{if eq .SortOrder "asc"}}desc{{else}}asc{{end}}{{else}}desc{{end}}"
                 hx-target="#file-list-container"
                 hx-push-url="false">
                Size
                {{if eq .SortBy "size"}}
                <svg class="ml-1 h-4 w-4 {{if eq .SortOrder "desc"}}transform rotate-180{{end}}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                </svg>
                {{end}}
            </div>
            <div class="col-span-3 flex items-center cursor-pointer hover:text-gray-700"
                 hx-get="/api/files?directory_id={{.CurrentDirectoryID}}&sort=date&order={{if eq .SortBy "date"}}{{if eq .SortOrder "asc"}}desc{{else}}asc{{end}}{{else}}desc{{end}}"
                 hx-target="#file-list-container"
                 hx-push-url="false">
                Modified
                {{if eq .SortBy "date"}}
                <svg class="ml-1 h-4 w-4 {{if eq .SortOrder "desc"}}transform rotate-180{{end}}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                </svg>
                {{end}}
            </div>
            <div class="col-span-1 text-right">Actions</div>
        </div>

        <!-- File Items -->
        <div class="divide-y divide-gray-200">
            {{range .Items}}
            {{template "file-item.html" .}}
            {{end}}
        </div>
    </div>

    <!-- Grid View -->
    <div id="file-grid"
         class="{{if ne .ViewMode "grid"}}hidden{{end}} grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 p-4"
         role="list"
         aria-label="File grid">
        {{range .Items}}
        {{template "file-item-grid.html" .}}
        {{end}}
    </div>
    {{end}}
</div>

<!-- Grid Item Template -->
{{define "file-item-grid.html"}}
<div class="file-item-grid group relative flex flex-col items-center p-4 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors duration-200"
     data-id="{{.ID}}"
     data-type="{{.Type}}"
     data-name="{{.Name}}"
     role="listitem"
     tabindex="0"
     aria-label="{{.Name}}"
     {{if eq .Type "directory"}}
     hx-get="/api/directories/{{.ID}}"
     hx-target="#file-list-container"
     hx-push-url="/files/{{.ID}}"
     {{end}}
     oncontextmenu="showContextMenu(event, '{{.ID}}', '{{.Type}}')">

    <!-- Selection Checkbox (hidden by default, shown on hover) -->
    <div class="absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition-opacity">
        <input type="checkbox"
               class="file-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary"
               data-id="{{.ID}}"
               aria-label="Select {{.Name}}"
               onclick="event.stopPropagation(); toggleFileSelection('{{.ID}}')">
    </div>

    <!-- Context Menu Button -->
    <button class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-gray-200 transition-opacity"
            onclick="event.stopPropagation(); showContextMenu(event, '{{.ID}}', '{{.Type}}')"
            aria-label="More options for {{.Name}}">
        <svg class="h-5 w-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path>
        </svg>
    </button>

    <!-- Icon -->
    <div class="w-16 h-16 flex items-center justify-center mb-2">
        {{if eq .Type "directory"}}
        <svg class="w-14 h-14 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
        </svg>
        {{else}}
        {{template "file-icon" .}}
        {{end}}
    </div>

    <!-- Name -->
    <span class="text-sm font-medium text-gray-900 text-center truncate w-full max-w-full" title="{{.Name}}">
        {{.Name}}
    </span>

    <!-- Size (for files only) -->
    {{if and (eq .Type "file") .Size}}
    <span class="text-xs text-gray-500 mt-1">{{.SizeFormatted}}</span>
    {{end}}
</div>
{{end}}
